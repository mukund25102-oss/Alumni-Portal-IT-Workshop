<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alumni Portal</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }

    /* Page base */
    html,body { height: 100%; }
    body { background: linear-gradient(180deg,#071129 0%, #071524 60%); color: #e6eef6; font-size: 16px; -webkit-font-smoothing:antialiased; }

    /* Decorative animated blobs behind the content */
    .bg-accent { position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden; }
    .bg-accent .blob { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.16; transform: translateZ(0); }
    .bg-accent .b1 { width: 520px; height: 520px; background: radial-gradient(circle at 30% 30%, rgba(124,58,237,0.95), rgba(124,58,237,0.25) 40%, transparent 60%); left: -120px; top: -80px; animation: float1 12s ease-in-out infinite; }
    .bg-accent .b2 { width: 420px; height: 420px; background: radial-gradient(circle at 70% 70%, rgba(6,182,212,0.92), rgba(20,184,166,0.20) 40%, transparent 60%); right: -100px; bottom: -110px; animation: float2 14s ease-in-out infinite; opacity: 0.12; }
    @keyframes float1 { 0%{transform:translateY(0) translateX(0)}50%{transform:translateY(18px) translateX(16px)}100%{transform:translateY(0) translateX(0)} }
    @keyframes float2 { 0%{transform:translateY(0) translateX(0)}50%{transform:translateY(-14px) translateX(-18px)}100%{transform:translateY(0) translateX(0)} }

    header { position: sticky; top: 0; z-index: 12; background: linear-gradient(180deg, rgba(4,6,15,0.6), rgba(6,8,20,0.3)); backdrop-filter: blur(8px); border-bottom: 1px solid rgba(148,163,184,0.06); }
  .container { max-width: 1200px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
    .brand { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .brand h1 { font-size: 1.9rem; letter-spacing: 0.6px; margin-right: 18px; }
    .nav a { color: #dbeafe; text-decoration: none; margin-left: 18px; font-weight: 700; }
    .nav a:hover { color: #9be7ff; }

  /* Hero */
  .hero { padding: 8px 20px 4px; text-align: center; animation: fadeIn 0.7s ease-in-out; }
  .hero-title { font-size: 1.9rem; color: #fff; font-weight: 800; margin-bottom: 4px; }
  .hero-sub { color: #9fb8cc; font-size: 0.98rem; margin-top: 3px; }

  .controls { padding: 6px 12px 12px; animation: slideDown 0.6s ease-in-out; }
  .controls-inner { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; align-items: center; }
  /* result count */
  #resultCount strong { color: #e6eef6; }
  .input, .select { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.04); color: #e6eef6; padding: 12px 14px; border-radius: 12px; min-width: 260px; box-shadow: inset 0 1px 0 rgba(255,255,255,0.02); }
    .input::placeholder { color: #93a6bd; }

  /* Dropdown option text: ensure options are readable when native dropdown background is white */
  option, select option, .input option, .select option { color: #000 !important; }

  .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 18px; padding: 8px 20px 28px; }
    @media (max-width: 1100px) { .grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 640px) { .grid { grid-template-columns: 1fr; } }

    .card { 
      background: linear-gradient(180deg, rgba(255,255,255,0.98) 0%, rgba(245,255,252,0.98) 100%);
      color: #064e3b;
      border: 1px solid rgba(6,78,59,0.08);
      border-radius: 16px; 
      overflow: hidden; 
      transition: transform 0.32s cubic-bezier(.2,.9,.2,1), box-shadow 0.32s ease; 
      opacity: 0; 
      transform: translateY(22px); 
      animation: fadeUp 0.8s forwards; 
      cursor: pointer; box-shadow: 0 10px 30px rgba(2,6,23,0.5);
    }
    .card:hover { transform: translateY(-10px) rotate(-0.4deg) scale(1.03); border-color: rgba(6,78,59,0.16); box-shadow: 0 28px 60px rgba(2,6,23,0.56); }
    .card img { transition: transform 0.6s ease; display:block; width:100%; height:220px; object-fit:cover; }
    .card:hover img { transform: scale(1.05); }
    /* staggered reveal */
    .card[data-index] { animation-delay: calc(var(--i) * 70ms); }
    .card-body { padding: 18px; }
  .badge { display: inline-block; font-size: 0.78rem; padding: 6px 10px; border-radius: 999px; background: linear-gradient(90deg,#06b6d4,#14b8a6); color: #fff; font-weight: 700; margin-bottom: 10px; }
  .title { font-size: 1.28rem; margin-bottom: 8px; color: #064e3b; font-weight: 700; }
  .desc { font-size: 1rem; color: #0f766e; min-height: 52px; line-height: 1.35; }
    .meta { display: flex; justify-content: space-between; align-items: center; margin-top: 14px; color: #6b7f8f; font-size: 0.95rem; }
  .btn { display: inline-block; margin-top: 12px; background: linear-gradient(90deg,#7c3aed,#06b6d4); color: #fff; text-decoration: none; font-weight: 700; padding: 12px 14px; border-radius: 12px; transition: transform 0.18s ease, box-shadow 0.18s ease; border: none; cursor: pointer; }
  .btn:hover { transform: translateY(-3px); box-shadow: 0 12px 34px rgba(124,58,237,0.12); }

    footer { border-top: 1px solid rgba(148,163,184,0.06); padding: 28px; text-align: center; color: #93a6bd; }

    /* Animations */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-18px); } to { opacity: 1; transform: translateY(0); } }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .bg-accent .blob, .card { animation: none !important; transition: none !important; }
    }
  </style>
</head>
<body>
  <!-- decorative animated background accents -->
  <div class="bg-accent" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
  </div>
  <header>
    <div class="container brand">
      <h1 id="brandTitle">Alumni Portal</h1>
      <nav class="nav">
        <a href="#about">About</a>
        <a href="#contact">Contact</a>
      </nav>
      <div style="display:flex;align-items:center;gap:8px;margin-left:12px">
        <button id="headerAccountBtn" class="btn" aria-haspopup="true" aria-expanded="false" title="Account" style="display:flex;align-items:center;gap:8px">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12c2.7614 0 5-2.2386 5-5s-2.2386-5-5-5-5 2.2386-5 5 2.2386 5 5 5z" fill="currentColor"/><path d="M3 20c0-3.866 3.134-7 7-7h4c3.866 0 7 3.134 7 7v1H3v-1z" fill="currentColor"/></svg>
        </button>
        <button id="myProfileBtn" title="My Profile" class="btn" style="margin-left:8px;display:none;align-items:center;gap:8px;padding:8px 10px;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12c2.7614 0 5-2.2386 5-5s-2.2386-5-5-5-5 2.2386-5 5 2.2386 5 5 5z" fill="currentColor"/><path d="M3 20c0-3.866 3.134-7 7-7h4c3.866 0 7 3.134 7 7v1H3v-1z" fill="currentColor"/></svg>
        </button>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <div class="hero-title">IIIT NR Alumni Portal — Connect, Discover, Grow</div>
      <div class="hero-sub">Browse alumni, find opportunities, and keep the community alive. Use the filters to quickly narrow results.</div>
    </div>
  </section>

  <section class="controls" id="alumni">
    <div class="container">
      <div class="controls-inner">
        <input id="search" class="input" type="search" placeholder="Search alumni by name or keywords...">
        <select id="branch" class="select">
          <option value="all">All Branches</option>
          <option value="cse">CSE</option>
          <option value="ece">ECE</option>
          <option value="dsai">DSAI</option>
        </select>
        <select id="batch" class="select">
          <option value="all">All Batches</option>
          <option value="2020">2020</option>
          <option value="2021">2021</option>
          <option value="2022">2022</option>
        </select>
        <select id="company" class="select">
          <option value="all">All Companies</option>
          <option value="google">Google</option>
          <option value="microsoft">Microsoft</option>
          <option value="amazon">Amazon</option>
        </select>
  <div id="resultCount" aria-live="polite" style="align-self:center;color:#94a3b8;margin-left:8px">Showing <strong id="countNum">0</strong> profiles</div>
      </div>
    </div>
  </section>

  <section>
    <div class="container">
      <div id="cards" class="grid"></div>
    </div>
  </section>

  <section id="about" class="hero">
    <div class="container">
      <h2>About Alumni Network</h2>
      <p>Our Alumni Portal helps you stay connected with classmates, discover opportunities, and give back to your community.</p>
    </div>
  </section>

  <section id="contact" class="hero">
    <div class="container">
      <h2>Contact</h2>
      <p>Email: alumni@yourcollege.edu • Phone: +91-9876543210</p>
    </div>
  </section>

  <footer>
    © 2025 Your College Alumni • Built with ❤️
  </footer>

  <script>
  // start with an empty cache; we'll populate from the API (MySQL-backed) or a local fallback
  let alumniData = [];

  const cardsRoot = document.getElementById('cards');
  const searchInput = document.getElementById('search');
  const branchSelect = document.getElementById('branch');
  const batchSelect = document.getElementById('batch');
  const companySelect = document.getElementById('company');
  const countNum = document.getElementById('countNum');
  const brandTitle = document.getElementById('brandTitle');

  function createCard(alumni) {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${alumni.image}" alt="${alumni.name}">
      <div class="card-body">
        <span class="badge">${(alumni.branch||'').toUpperCase()}</span>
        <div class="title">${alumni.name}</div>
        <p class="desc">${alumni.desc || ''}</p>
        <div class="meta">
          <span>${alumni.batch || ''} Batch</span>
          <span>${alumni.company || ''}</span>
        </div>
        <button class="btn" aria-label="View profile of ${alumni.name}">View Profile</button>
      </div>
    `;
    return card;
  }

  function render(list) {
    cardsRoot.innerHTML = '';
    list.forEach((alumni, idx) => {
      const c = createCard(alumni);
      c.style.setProperty('--i', idx);
      c.setAttribute('data-index', idx);
      c.classList.add('reveal-target');
      cardsRoot.appendChild(c);
    });
    countNum.textContent = list.length;
  }

  function applyFilters() {
    const q = (searchInput.value || '').trim().toLowerCase();
    const br = branchSelect.value;
    const ba = batchSelect.value;
    const co = companySelect.value;
    const filtered = alumniData.filter(a => {
      const inText = `${a.name} ${a.desc || ''} ${a.company || ''}`.toLowerCase().includes(q);
      const inBranch = br === 'all' ? true : (a.branch === br);
      const inBatch = ba === 'all' ? true : (a.batch === ba);
      const inCompany = co === 'all' ? true : (a.company === co);
      return inText && inBranch && inBatch && inCompany;
    });
    render(filtered);
  }

  searchInput.addEventListener('input', applyFilters);
  branchSelect.addEventListener('change', applyFilters);
  batchSelect.addEventListener('change', applyFilters);
  companySelect.addEventListener('change', applyFilters);

  brandTitle.addEventListener('click', () => {
    searchInput.value = '';
    branchSelect.value = 'all';
    batchSelect.value = 'all';
    companySelect.value = 'all';
    applyFilters();
  });

  // Flexible API base: default to localhost:4000, allow overrides via query params
  let API_BASE = 'http://localhost:4000';
  const params = new URLSearchParams(window.location.search);
  const explicitBase = params.get('apiBase');
  const portParam = params.get('apiPort');
  const hostParam = params.get('apiHost');
  if (explicitBase) {
    API_BASE = explicitBase.replace(/\/$/, '');
  } else if (hostParam || portParam) {
    const host = hostParam || 'localhost';
    const port = portParam || '4000';
    API_BASE = `http://${host}:${port}`;
  }

  // allow forcing API-only mode via ?forceApi=1 or remember with localStorage key 'alumni_api_only'
  const FORCE_API = (params.get('forceApi') === '1') || (localStorage.getItem('alumni_api_only') === '1');

  // show API status
  const controlsContainer = document.querySelector('.controls .container');
  const apiStatusEl = document.createElement('div');
  apiStatusEl.style.marginTop = '8px';
  apiStatusEl.style.color = '#9fb8cc';
  apiStatusEl.id = 'apiStatus';
  if (controlsContainer) controlsContainer.appendChild(apiStatusEl);

  // diagnostics widget (shows where data was loaded from and a sample row)
  const diag = document.createElement('div');
  diag.id = 'diagnostics';
  diag.style.marginTop = '6px';
  diag.style.fontSize = '0.9rem';
  diag.style.color = '#9fb8cc';
  diag.innerHTML = `<strong>Diagnostics:</strong> <span id="diagMsg">checking...</span>
    &nbsp; <label style="font-weight:600;margin-left:8px;color:#cde;"> <input type="checkbox" id="apiOnlyToggle"> API-only (no local fallback)</label>`;
  if (controlsContainer) controlsContainer.appendChild(diag);
  try {
    const t = document.getElementById('apiOnlyToggle');
    t.checked = !!FORCE_API;
    t.addEventListener('change', (e) => {
      if (e.target.checked) localStorage.setItem('alumni_api_only','1'); else localStorage.removeItem('alumni_api_only');
      // give the user a hint
      apiStatusEl.textContent = e.target.checked ? 'API-only enabled. Reload to apply.' : 'API-only disabled. Reload to apply.';
    });
  } catch (e) {}

  async function checkApi() {
    const parsed = new URL(API_BASE);
    const port = (parsed.port || portParam || '4000');
    const hosts = [hostParam || parsed.hostname || 'localhost', '127.0.0.1'];
    for (const h of hosts) {
      const url = `http://${h}:${port}/api/alumni`;
      apiStatusEl.textContent = `Checking API at ${url} ...`;
      try {
        const controller = new AbortController();
        const id = setTimeout(() => controller.abort(), 3000);
        const res = await fetch(url, { signal: controller.signal });
        clearTimeout(id);
        const ct = (res.headers.get('content-type') || '').toLowerCase();
        if (ct.includes('text/html')) {
          apiStatusEl.textContent = `Received HTML from ${url}. It looks like a static server is running on the API port ${port}. Start the API server.`;
          apiStatusEl.style.color = '#ff8a8a';
          continue;
        }
        if (res.ok) {
          API_BASE = `http://${h}:${port}`;
          apiStatusEl.textContent = `API reachable at ${API_BASE}`;
          apiStatusEl.style.color = '#8ef';
          return true;
        } else {
          apiStatusEl.textContent = `API reachable but returned ${res.status} at ${url}`;
          apiStatusEl.style.color = '#ffcc66';
        }
      } catch (err) {
        apiStatusEl.textContent = `Cannot reach API at ${url}: ${err.name || err.message}`;
        apiStatusEl.style.color = '#ff8a8a';
      }
    }
    return false;
  }

  // local fallback: alumni.json
  async function loadLocalFallback() {
    try {
      apiStatusEl.textContent = 'API unreachable. Loading local alumni.json ...';
      apiStatusEl.style.color = '#ffcc66';
      const res = await fetch('alumni.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('Missing alumni.json (' + res.status + ')');
      const rows = await res.json();
      alumniData = rows.map(r => {
        let image = '';
        if (r.image) image = r.image.startsWith('http') ? r.image : r.image;
        else image = 'https://picsum.photos/seed/' + encodeURIComponent(r.name || 'anon') + '/800/600';
        return { name: r.name, branch: r.branch || '', batch: r.batch || '', company: r.company || '', desc: r.description || r.desc || '', image: image, id: r.id || r.name };
      });
      applyFilters();
      apiStatusEl.textContent = 'Loaded local data (alumni.json).';
      apiStatusEl.style.color = '#9fb8cc';
    } catch (err) {
      apiStatusEl.textContent = 'Failed to load local alumni.json: ' + (err.message || err.name);
      apiStatusEl.style.color = '#ff8a8a';
      console.error('Local fallback failed', err);
    }
  }

  // load from server
  async function loadFromServer() {
    const ok = await checkApi();
    if (!ok) {
      if (FORCE_API) {
        apiStatusEl.textContent = `API unreachable and API-only is enabled; not using local fallback.`;
        apiStatusEl.style.color = '#ff8a8a';
        try { document.getElementById('diagMsg').textContent = 'API-only mode: no data loaded (API unreachable)'; } catch(e){}
        return;
      }
      return loadLocalFallback();
    }
    try {
      const res = await fetch(API_BASE + '/api/alumni');
      if (!res.ok) throw new Error('Server responded ' + res.status);
      const rows = await res.json();
      // show diagnostics info
      try { document.getElementById('diagMsg').textContent = `Loaded ${rows.length} rows from API (X-Data-Source: ${res.headers.get('x-data-source') || 'unknown'})`; } catch(e){}
      alumniData = rows.map(r => {
        let image = '';
        if (r.image) image = r.image.startsWith('http') ? r.image : (API_BASE.replace(/\/$/, '') + r.image);
        else image = 'https://picsum.photos/seed/' + encodeURIComponent(r.name || 'anon') + '/800/600';
        return { name: r.name, branch: r.branch || '', batch: r.batch || '', company: r.company || '', desc: r.description || r.desc || '', image: image, id: r.id };
      });
      applyFilters();
    } catch (err) {
      console.error('Failed to load alumni', err);
      apiStatusEl.textContent = 'Failed to load alumni: ' + (err.message || err.name);
      apiStatusEl.style.color = '#ff8a8a';
      // fall back to local
      loadLocalFallback();
    }
  }

  loadFromServer();

  // IntersectionObserver for reveal
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const el = entry.target;
      if (entry.isIntersecting) {
        el.classList.add('in-view');
        observer.unobserve(el);
      }
    });
  }, { root: null, rootMargin: '0px 0px -10% 0px', threshold: 0.15 });

  const observeCards = () => {
    document.querySelectorAll('.card').forEach(card => observer.observe(card));
  };

  // override render to observe
  const _origRender = render;
  render = function(list){
    cardsRoot.innerHTML = '';
    list.forEach((alumni, idx) => {
      const c = createCard(alumni);
      c.style.setProperty('--i', idx);
      c.setAttribute('data-index', idx);
      cardsRoot.appendChild(c);
    });
    countNum.textContent = list.length;
    observeCards();
  }
  // If this page had an account dropdown/logout, ensure logout resets UI and redirects
  (function(){
    try {
      const headerLogout = document.getElementById('headerLogout');
      const acctBtn = document.getElementById('headerAccountBtn');
      const accountDropdown = document.getElementById('accountDropdown');
      const myBtn = document.getElementById('myProfileBtn');
      const LS_KEY = 'alumni_login_id';
      if (headerLogout) {
        // hide if no user
        try { const existing = localStorage.getItem(LS_KEY); if (headerLogout) headerLogout.style.display = existing ? '' : 'none'; if (myBtn) myBtn.style.display = existing ? '' : 'none'; if (myBtn && existing) myBtn.addEventListener('click', ()=>{ window.location.href = 'profile.html?id='+encodeURIComponent(existing); }); } catch(e){}
        headerLogout.addEventListener('click', ()=>{
          try {
            const prefix = 'alumni_';
            for (let i = localStorage.length - 1; i >= 0; i--) { const k = localStorage.key(i); if (k && k.indexOf(prefix) === 0) localStorage.removeItem(k); }
            for (let i = sessionStorage.length - 1; i >= 0; i--) { const k = sessionStorage.key(i); if (k && k.indexOf(prefix) === 0) sessionStorage.removeItem(k); }
            localStorage.removeItem(LS_KEY);
          } catch(e){}
          try { const lbl = acctBtn && acctBtn.querySelector('.label'); if (lbl) lbl.textContent = 'Account'; if (myBtn) myBtn.style.display = 'none'; if (accountDropdown) accountDropdown.style.display='none'; if (acctBtn) acctBtn.setAttribute('aria-expanded','false'); } catch(e){}
          try { const params = new URLSearchParams(window.location.search); let target = (params.get('afterLogout')||'').trim() || 'mainad.html'; if (/^https?:\/\//i.test(target)) { const parsed=new URL(target, window.location.origin); if (parsed.origin !== window.location.origin) target = 'mainad.html'; } window.location.href = target; } catch(e){ window.location.href='mainad.html'; }
        });
      }
    } catch (e) { /* ignore */ }
  })();
  </script>
</body>
</html>
